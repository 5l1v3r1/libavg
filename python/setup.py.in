import os
import glob
from distutils.core import setup
from distutils.command.build import build as _build
from distutils.command.build_scripts import build_scripts as _build_scripts

class MyBuild(_build):
    def run(self):
        _build.run(self)
        self.copy_file('$<TARGET_FILE:avg>', os.path.join(self.build_lib, 'libavg'))

class MyBuildScripts(_build_scripts):
    def finalize_options(self):
        _build_scripts.finalize_options(self)
        self.force = True

setup(name='libavg',
    version='${AVG_VERSION_RELEASE}',
    package_dir={'':  '${CMAKE_CURRENT_SOURCE_DIR}'},
    packages=['libavg', 'libavg.app', 'libavg.widget'],
    package_data={'libavg': ['data/*']},
    cmdclass={'build': MyBuild, 'build_scripts': MyBuildScripts},
    scripts=glob.glob('${CMAKE_CURRENT_SOURCE_DIR}/scripts/avg_*'),
)
